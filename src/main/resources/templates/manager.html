<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/head :: head('管理者ページ')"></div>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/locales-all.min.js"></script>
    <style>
        .user-checkbox {
            width: 20px;
            height: 20px;
        }
        .checkbox-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);  /* 3列のグリッドレイアウト */
            gap: 10px;  /* アイテム間のスペース */
            justify-content: center;  /* 中央揃え */
            max-width: 600px;  /* コンテナの最大幅を指定 */
            margin: 0 auto;  /* 中央に寄せるための余白 */
        }
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        .checkbox-label {
            margin-left: 10px;
            font-size: 16px;
        }
    </style>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            // Thymeleaf変数をJavaScriptに変換
            var events = /*[[${eventsJson}]]*/ '[]';
            console.log("Events JSON from Thymeleaf: " + events);  // デバッグ用

            // JSON文字列をJavaScriptオブジェクトに変換
            events = JSON.parse(events);

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: events,
                locale: 'ja',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                }
            });

            calendar.render();

            // チェックボックスの変更を監視してカレンダーを更新する
            function updateCalendar() {
                var allUserCheckbox = document.getElementById('all-users-checkbox');
                var selectedUserIds;

                if (allUserCheckbox.checked) {
                    selectedUserIds = events.map(event => event.userId.toString());
                } else {
                    selectedUserIds = Array.from(document.querySelectorAll('.user-checkbox:checked')).map(cb => cb.value);
                }

                var filteredEvents = events.filter(event => selectedUserIds.includes(event.userId.toString()));
                calendar.removeAllEvents();
                calendar.addEventSource(filteredEvents);
            }

            document.getElementById('all-users-checkbox').addEventListener('change', function() {
                var userCheckboxes = document.querySelectorAll('.user-checkbox');
                userCheckboxes.forEach(function(checkbox) {
                    checkbox.checked = this.checked;
                }, this);
                updateCalendar();
            });

            document.querySelectorAll('.user-checkbox').forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    var allUserCheckbox = document.getElementById('all-users-checkbox');
                    if (Array.from(document.querySelectorAll('.user-checkbox')).every(cb => cb.checked)) {
                        allUserCheckbox.checked = true;
                    } else {
                        allUserCheckbox.checked = false;
                    }
                    updateCalendar();
                });
            });
        });
        /*]]>*/
    </script>
</head>
<body class="bg-gray-100">

<nav th:replace="fragments/nav :: nav"></nav>

<div class="container mx-auto mt-8 px-4 text-center">

    <h1 class="text-3xl font-bold text-gray-800 mb-4">シフト作成者ページ</h1>

    <div class="mb-4">
        <label class="block text-lg font-medium text-gray-700 mb-2">　</label>
        <div class="checkbox-container">
            <div class="checkbox-item">
                <input type="checkbox" id="all-users-checkbox" value="all" class="user-checkbox">
                <label for="all-users-checkbox" class="checkbox-label">全ユーザー</label>
            </div>
            <div th:each="user : ${users}" class="checkbox-item">
                <input type="checkbox" class="user-checkbox" th:value="${user.id}" th:id="'user-checkbox-' + ${user.id}">
                <label th:for="'user-checkbox-' + ${user.id}" th:text="${user.name}" class="checkbox-label"></label>
            </div>
        </div>
    </div>

    <div id='calendar' class="bg-white p-6 rounded shadow-md mb-4"></div>
    <a th:href="@{/}" class="btn mt-6 ">ホームへ戻る</a>
</div>

</body>
</html>
