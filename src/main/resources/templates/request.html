<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>シフト希望登録</title>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/locales-all.min.js'></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var selectedDates = [];
            var userName = /*[[${user.name}]]*/ 'ユーザー名';

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ja',
                selectable: true,
                unselectAuto: false,
                select: function(info) {
                    var dateStr = info.startStr;
                    if (selectedDates.includes(dateStr)) {
                        selectedDates = selectedDates.filter(date => date !== dateStr);
                        calendar.getEventById(dateStr).remove();
                    } else {
                        selectedDates.push(dateStr);
                        calendar.addEvent({
                            id: dateStr,
                            title: userName,
                            start: dateStr,
                            allDay: true
                        });
                    }
                }
            });

            calendar.render();

            document.getElementById('submit-button').addEventListener('click', function() {
                var datesInput = document.getElementById('dates-input');
                datesInput.value = selectedDates.join(',');
            });
        });
        /*]]>*/
    </script>
</head>
<body>
<h1><span th:text="${user.name}"></span>のシフト登録画面</h1>

<form th:action="@{/shift/request}" method="post">
    <input type="hidden" name="userId" th:value="${user.id}" />
    <input type="hidden" id="dates-input" name="dates" />

    <div id='calendar'></div>

    <button type="submit" id="submit-button">シフト提出</button>
</form>

<a th:href="@{/}">ホームへ戻る</a>
</body>
</html>
